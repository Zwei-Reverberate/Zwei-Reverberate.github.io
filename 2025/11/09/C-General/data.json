{"title":"C++ General","date":"2025-11-09T14:59:09.000Z","toc":true,"summary":"C++ 通义","source":"_posts/C-General.md","raw":"---\ntitle: C++ General\ndate: 2025-11-09 22:59:09\ntags: C++\ntoc: true\nsummary: \"C++ 通义\"\n---\n\n# 1. C++ 设计准则\n\n## 1. Philosophy\n\n### 1. 保持代码直观清晰\n\n```c++\nclass Date\n{\npublic:\n    Month month() const; // do\n    int month(); // don't\n}\n```\n\n在上述示例中，前者是更好的写法，它的返回值是类型明确的，并且本身具有 const 限定。\n\n&nbsp;\n\n```c++\nint index = -1;\nfor(int i = 0; i < v.size(); ++i)\n{\n    if(v[i] == val)\n    {\n        index = i;\n        break;\n    }\n} // bad\n\nauto it = std::find(std::begin(v), std::end(v), val); // better\n```\n\n使用 STL 能使代码更加清晰简洁，不易出错。有一句现代 C++ 谚语：如果你还在显式地使用循环，那么你就没有真正理解 STL 算法。\n\n&nbsp;\n\n### 2. 遵循 ISO Standard\n\n按照由国际标准化组织（ISO）制定并发布的《ISO/IEC 14882》C++ 标准来编写代码。\n\n这意味着尽量避免依赖各编译器厂商（如 GCC、MSVC、Clang）提供的额外语法或库扩展，以保证代码在不同环境下都能编译和运行。\n\n另外，需要注意 Undefined Behavior 和 Implementation‑Defined Behavior\n\n- Undefined Behavior\n\n  指 C++ 标准未明确规定行为规范的代码操作，允许编译器自由处理。程序可能崩溃、产生错误结果、或看似正常运行实则存在隐患。程序应避免任何 UB。\n\n   [*未定义行为完整列表*](https://parallel101.github.io/cppguidebook/undef/)\n\n- Implementation‑Defined Behavior\n\n  指 C++ 标准允许编译器或运行时环境自由选择具体实现方式，但要求该行为必须被明确文档化。虽然具有平台依赖性，但结果是可预测的，由特定编译器的实现文档保证。\n\n&nbsp;\n\n### 3. 注释应写明意图\n\n```c++\nfor(const auto& v : vec) {...} // (1)\n\nfor(auto& v : vec) {...} // (2)\n\nstd::for_each(std::execution::par, vec.begin(), vec.end(), [](auto& v) {...}); // (3)\n```\n\n上述示例中，(1) 与 (2) 的区别在于前者不会修改容器中的元素。\n\n(3) 是使用并行的方式对容器中的每个元素执行一个操作。但是需要注意的小规模数据可能因线程调度开销导致性能下降，这种写法更适用于大规模数据。\n\n总之，注释应阐明意图，指出应该做什么。\n\n&nbsp;\n\n### 4. 保证程序的静态类型安全\n\nC++ 是静态类型语言。即所有的变量或表达式的类型必须在编译时确定。静态类型安全要求编译器不仅知道其类型，还要能检测出类型相关的错误。C++ 并非完全类型安全，因此需要在编写代码时人工规避问题。\n\n以下是常见的类型安全的问题及规避方案：\n\n- 联合体（Union）\n\n  联合体允许不同类型共享同一内存空间，同一时间只能存储一个成员的值，可以达到节省内存的效果，`union` 的大小等于其最大成员的大小；\n\n  `union` 不记录当前活跃的成员，访问错误的成员会导致未定义行为。\n\n  ```c++\n  union Data \n  {\n      int i;\n      float f;\n  };\n  \n  Data data;\n  data.i = 10;\n  std::cout << data.f << std::endl; // 错误：此时通过 f 访问是未定义行为\n  ```\n\n  \n\n\n\n----\n\n**Reference**\n\n- [*C++ Core Guidelines Explained: Best Practices for Modern C++*](https://www.google.com/books/edition/C++_Core_Guidelines_Explained/ptnPEAAAQBAJ?hl=en&gbpv=0)\n- [*现代 C++ 教程*](https://www.bilibili.com/video/BV1D84y1t76J/?spm_id_from=333.788.comment.all.click&vd_source=aec47f6b52af3774b903cb0d25607f6c)\n- [*小彭大典*](https://parallel101.github.io/cppguidebook/)","slug":"C-General","published":true,"updated":"2025-11-09T15:02:03.416Z","_id":"cmhrudxky00005kcn5jz2f7fa","comments":true,"layout":"post","photos":[],"html":"<h1>1. C++ 设计准则</h1>\n<h2 id=\"1-Philosophy\">1. Philosophy</h2>\n<h3 id=\"1-保持代码直观清晰\">1. 保持代码直观清晰</h3>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Date</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\">Month <span class=\"title\">month</span><span class=\"params\">()</span> <span class=\"type\">const</span></span>; <span class=\"comment\">// do</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">month</span><span class=\"params\">()</span></span>; <span class=\"comment\">// don&#x27;t</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在上述示例中，前者是更好的写法，它的返回值是类型明确的，并且本身具有 const 限定。</p>\n<p> </p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> index = <span class=\"number\">-1</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; v.<span class=\"built_in\">size</span>(); ++i)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(v[i] == val)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        index = i;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; <span class=\"comment\">// bad</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">auto</span> it = std::<span class=\"built_in\">find</span>(std::<span class=\"built_in\">begin</span>(v), std::<span class=\"built_in\">end</span>(v), val); <span class=\"comment\">// better</span></span><br></pre></td></tr></table></figure>\n<p>使用 STL 能使代码更加清晰简洁，不易出错。有一句现代 C++ 谚语：如果你还在显式地使用循环，那么你就没有真正理解 STL 算法。</p>\n<p> </p>\n<h3 id=\"2-遵循-ISO-Standard\">2. 遵循 ISO Standard</h3>\n<p>按照由国际标准化组织（ISO）制定并发布的《ISO/IEC 14882》C++ 标准来编写代码。</p>\n<p>这意味着尽量避免依赖各编译器厂商（如 GCC、MSVC、Clang）提供的额外语法或库扩展，以保证代码在不同环境下都能编译和运行。</p>\n<p>另外，需要注意 Undefined Behavior 和 Implementation‑Defined Behavior</p>\n<ul>\n<li>\n<p>Undefined Behavior</p>\n<p>指 C++ 标准未明确规定行为规范的代码操作，允许编译器自由处理。程序可能崩溃、产生错误结果、或看似正常运行实则存在隐患。程序应避免任何 UB。</p>\n<p><a href=\"https://parallel101.github.io/cppguidebook/undef/\"><em>未定义行为完整列表</em></a></p>\n</li>\n<li>\n<p>Implementation‑Defined Behavior</p>\n<p>指 C++ 标准允许编译器或运行时环境自由选择具体实现方式，但要求该行为必须被明确文档化。虽然具有平台依赖性，但结果是可预测的，由特定编译器的实现文档保证。</p>\n</li>\n</ul>\n<p> </p>\n<h3 id=\"3-注释应写明意图\">3. 注释应写明意图</h3>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"type\">const</span> <span class=\"keyword\">auto</span>&amp; v : vec) &#123;...&#125; <span class=\"comment\">// (1)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">auto</span>&amp; v : vec) &#123;...&#125; <span class=\"comment\">// (2)</span></span><br><span class=\"line\"></span><br><span class=\"line\">std::for_each(std::execution::par, vec.<span class=\"built_in\">begin</span>(), vec.<span class=\"built_in\">end</span>(), [](<span class=\"keyword\">auto</span>&amp; v) &#123;...&#125;); <span class=\"comment\">// (3)</span></span><br></pre></td></tr></table></figure>\n<p>上述示例中，(1) 与 (2) 的区别在于前者不会修改容器中的元素。</p>\n<p>(3) 是使用并行的方式对容器中的每个元素执行一个操作。但是需要注意的小规模数据可能因线程调度开销导致性能下降，这种写法更适用于大规模数据。</p>\n<p>总之，注释应阐明意图，指出应该做什么。</p>\n<p> </p>\n<h3 id=\"4-保证程序的静态类型安全\">4. 保证程序的静态类型安全</h3>\n<p>C++ 是静态类型语言。即所有的变量或表达式的类型必须在编译时确定。静态类型安全要求编译器不仅知道其类型，还要能检测出类型相关的错误。C++ 并非完全类型安全，因此需要在编写代码时人工规避问题。</p>\n<p>以下是常见的类型安全的问题及规避方案：</p>\n<ul>\n<li>\n<p>联合体（Union）</p>\n<p>联合体允许不同类型共享同一内存空间，同一时间只能存储一个成员的值，可以达到节省内存的效果，<code>union</code> 的大小等于其最大成员的大小；</p>\n<p><code>union</code> 不记录当前活跃的成员，访问错误的成员会导致未定义行为。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">union</span> <span class=\"title class_\">Data</span> </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> i;</span><br><span class=\"line\">    <span class=\"type\">float</span> f;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Data data;</span><br><span class=\"line\">data.i = <span class=\"number\">10</span>;</span><br><span class=\"line\">std::cout &lt;&lt; data.f &lt;&lt; std::endl; <span class=\"comment\">// 错误：此时通过 f 访问是未定义行为</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<hr>\n<p><strong>Reference</strong></p>\n<ul>\n<li><a href=\"https://www.google.com/books/edition/C++_Core_Guidelines_Explained/ptnPEAAAQBAJ?hl=en&amp;gbpv=0\"><em>C++ Core Guidelines Explained: Best Practices for Modern C++</em></a></li>\n<li><a href=\"https://www.bilibili.com/video/BV1D84y1t76J/?spm_id_from=333.788.comment.all.click&amp;vd_source=aec47f6b52af3774b903cb0d25607f6c\"><em>现代 C++ 教程</em></a></li>\n<li><a href=\"https://parallel101.github.io/cppguidebook/\"><em>小彭大典</em></a></li>\n</ul>\n","excerpt":"","more":"<h1>1. C++ 设计准则</h1>\n<h2 id=\"1-Philosophy\">1. Philosophy</h2>\n<h3 id=\"1-保持代码直观清晰\">1. 保持代码直观清晰</h3>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Date</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\">Month <span class=\"title\">month</span><span class=\"params\">()</span> <span class=\"type\">const</span></span>; <span class=\"comment\">// do</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">month</span><span class=\"params\">()</span></span>; <span class=\"comment\">// don&#x27;t</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在上述示例中，前者是更好的写法，它的返回值是类型明确的，并且本身具有 const 限定。</p>\n<p> </p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> index = <span class=\"number\">-1</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; v.<span class=\"built_in\">size</span>(); ++i)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(v[i] == val)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        index = i;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; <span class=\"comment\">// bad</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">auto</span> it = std::<span class=\"built_in\">find</span>(std::<span class=\"built_in\">begin</span>(v), std::<span class=\"built_in\">end</span>(v), val); <span class=\"comment\">// better</span></span><br></pre></td></tr></table></figure>\n<p>使用 STL 能使代码更加清晰简洁，不易出错。有一句现代 C++ 谚语：如果你还在显式地使用循环，那么你就没有真正理解 STL 算法。</p>\n<p> </p>\n<h3 id=\"2-遵循-ISO-Standard\">2. 遵循 ISO Standard</h3>\n<p>按照由国际标准化组织（ISO）制定并发布的《ISO/IEC 14882》C++ 标准来编写代码。</p>\n<p>这意味着尽量避免依赖各编译器厂商（如 GCC、MSVC、Clang）提供的额外语法或库扩展，以保证代码在不同环境下都能编译和运行。</p>\n<p>另外，需要注意 Undefined Behavior 和 Implementation‑Defined Behavior</p>\n<ul>\n<li>\n<p>Undefined Behavior</p>\n<p>指 C++ 标准未明确规定行为规范的代码操作，允许编译器自由处理。程序可能崩溃、产生错误结果、或看似正常运行实则存在隐患。程序应避免任何 UB。</p>\n<p><a href=\"https://parallel101.github.io/cppguidebook/undef/\"><em>未定义行为完整列表</em></a></p>\n</li>\n<li>\n<p>Implementation‑Defined Behavior</p>\n<p>指 C++ 标准允许编译器或运行时环境自由选择具体实现方式，但要求该行为必须被明确文档化。虽然具有平台依赖性，但结果是可预测的，由特定编译器的实现文档保证。</p>\n</li>\n</ul>\n<p> </p>\n<h3 id=\"3-注释应写明意图\">3. 注释应写明意图</h3>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"type\">const</span> <span class=\"keyword\">auto</span>&amp; v : vec) &#123;...&#125; <span class=\"comment\">// (1)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">auto</span>&amp; v : vec) &#123;...&#125; <span class=\"comment\">// (2)</span></span><br><span class=\"line\"></span><br><span class=\"line\">std::for_each(std::execution::par, vec.<span class=\"built_in\">begin</span>(), vec.<span class=\"built_in\">end</span>(), [](<span class=\"keyword\">auto</span>&amp; v) &#123;...&#125;); <span class=\"comment\">// (3)</span></span><br></pre></td></tr></table></figure>\n<p>上述示例中，(1) 与 (2) 的区别在于前者不会修改容器中的元素。</p>\n<p>(3) 是使用并行的方式对容器中的每个元素执行一个操作。但是需要注意的小规模数据可能因线程调度开销导致性能下降，这种写法更适用于大规模数据。</p>\n<p>总之，注释应阐明意图，指出应该做什么。</p>\n<p> </p>\n<h3 id=\"4-保证程序的静态类型安全\">4. 保证程序的静态类型安全</h3>\n<p>C++ 是静态类型语言。即所有的变量或表达式的类型必须在编译时确定。静态类型安全要求编译器不仅知道其类型，还要能检测出类型相关的错误。C++ 并非完全类型安全，因此需要在编写代码时人工规避问题。</p>\n<p>以下是常见的类型安全的问题及规避方案：</p>\n<ul>\n<li>\n<p>联合体（Union）</p>\n<p>联合体允许不同类型共享同一内存空间，同一时间只能存储一个成员的值，可以达到节省内存的效果，<code>union</code> 的大小等于其最大成员的大小；</p>\n<p><code>union</code> 不记录当前活跃的成员，访问错误的成员会导致未定义行为。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">union</span> <span class=\"title class_\">Data</span> </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> i;</span><br><span class=\"line\">    <span class=\"type\">float</span> f;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Data data;</span><br><span class=\"line\">data.i = <span class=\"number\">10</span>;</span><br><span class=\"line\">std::cout &lt;&lt; data.f &lt;&lt; std::endl; <span class=\"comment\">// 错误：此时通过 f 访问是未定义行为</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<hr>\n<p><strong>Reference</strong></p>\n<ul>\n<li><a href=\"https://www.google.com/books/edition/C++_Core_Guidelines_Explained/ptnPEAAAQBAJ?hl=en&amp;gbpv=0\"><em>C++ Core Guidelines Explained: Best Practices for Modern C++</em></a></li>\n<li><a href=\"https://www.bilibili.com/video/BV1D84y1t76J/?spm_id_from=333.788.comment.all.click&amp;vd_source=aec47f6b52af3774b903cb0d25607f6c\"><em>现代 C++ 教程</em></a></li>\n<li><a href=\"https://parallel101.github.io/cppguidebook/\"><em>小彭大典</em></a></li>\n</ul>\n","path":"2025/11/09/C-General/","permalink":"https://zweireverberate.space/2025/11/09/C-General/","tags":[{"name":"C++","_id":"cmhrudxl400015kcn8x15hevj","slug":"C","path":"tags/C/","permalink":"https://zweireverberate.space/tags/C/","length":1}],"categories":[],"prev":{"title":"素影微行","date":"2989-06-04T06:36:24.000Z","summary":"随笔","slug":"素影微行","published":true,"updated":"2025-07-14T15:13:50.317Z","_id":"cmefcsga500017gcn3f043goh","layout":"post","photos":[],"excerpt":"","path":"2989/06/04/素影微行/","permalink":"https://zweireverberate.space/2989/06/04/%E7%B4%A0%E5%BD%B1%E5%BE%AE%E8%A1%8C/","__post":true},"next":{"title":"Coding Problems","date":"2025-10-26T12:05:21.000Z","summary":"算法练习题","slug":"Coding-Problems","published":true,"updated":"2025-11-02T08:11:00.332Z","_id":"cmh7o11j60000r4cn5skl1af9","layout":"post","photos":[],"excerpt":"","path":"2025/10/26/Coding-Problems/","permalink":"https://zweireverberate.space/2025/10/26/Coding-Problems/","__post":true},"__post":true}